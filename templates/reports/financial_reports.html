{% extends 'base/base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}Financial Reports - Cooperative Management{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <!-- Page Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h2 class="h4 mb-1">Financial Reports</h2>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0">
                        <li class="breadcrumb-item"><a href="{% url 'dashboard:home' %}">Dashboard</a></li>
                        <li class="breadcrumb-item"><a href="{% url 'reports:dashboard' %}">Reports</a></li>
                        <li class="breadcrumb-item active">Financial Reports</li>
                    </ol>
                </nav>
            </div>
        </div>

        <!-- Report Filters -->
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="card-title mb-0">
                    <i class="fas fa-filter me-2"></i>
                    Report Filters
                </h5>
            </div>
            <div class="card-body">
                <form method="get">
                    {% crispy form %}
                </form>
            </div>
        </div>

        <!-- Financial Reports Grid -->
        <div class="row g-4">
            <!-- Income Statement -->
            <div class="col-lg-6">
                <div class="card shadow-sm h-100">
                    <div class="card-header bg-success text-white">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-chart-line me-2"></i>
                            Income Statement
                        </h5>
                    </div>
                    <div class="card-body">
                        <p class="card-text">Generate profit and loss statement showing revenues and expenses for the selected period.</p>
                        <div class="mt-auto">
                            <a href="#" class="btn btn-success" onclick="generateIncomeStatement()">
                                <i class="fas fa-download me-2"></i>Generate P&L
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Balance Sheet -->
            <div class="col-lg-6">
                <div class="card shadow-sm h-100">
                    <div class="card-header bg-info text-white">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-balance-scale me-2"></i>
                            Balance Sheet
                        </h5>
                    </div>
                    <div class="card-body">
                        <p class="card-text">Generate balance sheet showing assets, liabilities, and equity at a specific point in time.</p>
                        <div class="mt-auto">
                            <a href="{% url 'reports:balance_sheet' %}" class="btn btn-info">
                                <i class="fas fa-download me-2"></i>Generate Balance Sheet
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cash Flow Statement -->
            <div class="col-lg-6">
                <div class="card shadow-sm h-100">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-water me-2"></i>
                            Cash Flow Statement
                        </h5>
                    </div>
                    <div class="card-body">
                        <p class="card-text">Track cash inflows and outflows from operating, investing, and financing activities.</p>
                        <div class="mt-auto">
                            <a href="{% url 'transactions:cash_flow' %}" class="btn btn-warning">
                                <i class="fas fa-download me-2"></i>View Cash Flow
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Trial Balance -->
            <div class="col-lg-6">
                <div class="card shadow-sm h-100">
                    <div class="card-header bg-dark text-white">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-calculator me-2"></i>
                            Trial Balance
                        </h5>
                    </div>
                    <div class="card-body">
                        <p class="card-text">Verify that total debits equal total credits in the accounting system.</p>
                        <div class="mt-auto">
                            <a href="#" class="btn btn-dark" onclick="generateTrialBalance()">
                                <i class="fas fa-download me-2"></i>Generate Trial Balance
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Account Summary -->
            <div class="col-lg-6">
                <div class="card shadow-sm h-100">
                    <div class="card-header bg-secondary text-white">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-list-alt me-2"></i>
                            Account Summary
                        </h5>
                    </div>
                    <div class="card-body">
                        <p class="card-text">Detailed summary of all accounts with balances and transaction counts.</p>
                        <div class="mt-auto">
                            <a href="#" class="btn btn-secondary" onclick="generateAccountSummary()">
                                <i class="fas fa-download me-2"></i>Generate Summary
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Budget vs Actual -->
            <div class="col-lg-6">
                <div class="card shadow-sm h-100">
                    <div class="card-header bg-danger text-white">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-chart-pie me-2"></i>
                            Budget vs Actual
                        </h5>
                    </div>
                    <div class="card-body">
                        <p class="card-text">Compare budgeted amounts against actual income and expenses.</p>
                        <div class="mt-auto">
                            <a href="#" class="btn btn-danger" onclick="generateBudgetReport()">
                                <i class="fas fa-download me-2"></i>Budget Analysis
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-header">
                        <h6 class="card-title mb-0">
                            <i class="fas fa-tachometer-alt me-2"></i>
                            Financial Overview
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-md-3">
                                <div class="border-end">
                                    <h4 class="text-success mb-1">$0.00</h4>
                                    <small class="text-muted">Total Assets</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="border-end">
                                    <h4 class="text-danger mb-1">$0.00</h4>
                                    <small class="text-muted">Total Liabilities</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="border-end">
                                    <h4 class="text-info mb-1">$0.00</h4>
                                    <small class="text-muted">Total Equity</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <h4 class="text-primary mb-1">$0.00</h4>
                                <small class="text-muted">Net Worth</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function generateIncomeStatement() {
    const filters = getReportFilters();
    window.open(`/reports/income-statement/?${filters}`, '_blank');
}

function generateTrialBalance() {
    const filters = getReportFilters();
    window.open(`/reports/trial-balance/?${filters}`, '_blank');
}

function generateAccountSummary() {
    const filters = getReportFilters();
    window.open(`/reports/account-summary/?${filters}`, '_blank');
}

function generateBudgetReport() {
    const filters = getReportFilters();
    window.open(`/reports/budget-analysis/?${filters}`, '_blank');
}

function getReportFilters() {
    const params = new URLSearchParams();
    const form = document.querySelector('form[method="get"]');
    const formData = new FormData(form);
    
    for (let [key, value] of formData.entries()) {
        if (value) {
            params.append(key, value);
        }
    }
    
    return params.toString();
}
</script>
{% endblock %}
