{% extends 'base/base.html' %}
{% load static %}

{% block title %}Reports & Analytics Dashboard{% endblock %}

{% block extra_css %}
<style>
.stats-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 15px;
    color: white;
    padding: 2rem;
    height: 100%;
}

.stats-card.success {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
}

.stats-card.warning {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
}

.stats-card.info {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
}

.report-category {
    background: white;
    border-radius: 15px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    padding: 2rem;
    margin-bottom: 2rem;
    transition: all 0.3s ease;
}

.report-category:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.report-item {
    border: 2px solid #e9ecef;
    border-radius: 10px;
    padding: 1.5rem;
    margin-bottom: 1rem;
    transition: all 0.3s ease;
    cursor: pointer;
}

.report-item:hover {
    border-color: #667eea;
    background: rgba(102, 126, 234, 0.05);
}

.report-icon {
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.5rem;
}

.chart-container {
    background: white;
    border-radius: 15px;
    padding: 1.5rem;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    height: 400px;
}

.quick-stat {
    text-align: center;
    padding: 1rem;
    background: #f8f9fa;
    border-radius: 10px;
    margin-bottom: 1rem;
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="display-6 mb-0">
                        <i class="fas fa-chart-bar text-primary me-3"></i>
                        Reports & Analytics
                    </h1>
                    <p class="text-muted">Generate comprehensive reports and analyze cooperative performance</p>
                </div>
                <div>
                    <button class="btn btn-primary btn-lg me-2" data-bs-toggle="modal" data-bs-target="#quickReportModal">
                        <i class="fas fa-bolt me-2"></i>Quick Report
                    </button>
                    <a href="{% url 'reports:custom' %}" class="btn btn-outline-primary btn-lg">
                        <i class="fas fa-cogs me-2"></i>Custom Report
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Statistics Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="stats-card">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h3 class="mb-0">{{ total_members }}</h3>
                        <p class="mb-0">Total Members</p>
                    </div>
                    <div class="display-4">
                        <i class="fas fa-users"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stats-card success">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h3 class="mb-0">₦{{ total_savings|floatformat:0 }}</h3>
                        <p class="mb-0">Total Savings</p>
                    </div>
                    <div class="display-4">
                        <i class="fas fa-piggy-bank"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stats-card warning">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h3 class="mb-0">₦{{ total_loans|floatformat:0 }}</h3>
                        <p class="mb-0">Outstanding Loans</p>
                    </div>
                    <div class="display-4">
                        <i class="fas fa-hand-holding-usd"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stats-card info">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h3 class="mb-0">{{ monthly_transactions }}</h3>
                        <p class="mb-0">Monthly Transactions</p>
                    </div>
                    <div class="display-4">
                        <i class="fas fa-exchange-alt"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Report Categories -->
    <div class="row">
        <!-- Financial Reports -->
        <div class="col-md-6 mb-4">
            <div class="report-category">
                <div class="d-flex align-items-center mb-3">
                    <div class="report-icon me-3">
                        <i class="fas fa-file-invoice-dollar"></i>
                    </div>
                    <div>
                        <h4 class="mb-0">Financial Reports</h4>
                        <p class="text-muted mb-0">Balance sheets, income statements, and financial analysis</p>
                    </div>
                </div>
                <div class="row">
                    <div class="col-6">
                        <div class="report-item" onclick="generateReport('balance_sheet')">
                            <h6 class="mb-1">Balance Sheet</h6>
                            <small class="text-muted">Assets, liabilities, and equity</small>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="report-item" onclick="generateReport('income_statement')">
                            <h6 class="mb-1">Income Statement</h6>
                            <small class="text-muted">Revenue and expenses</small>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="report-item" onclick="generateReport('cash_flow')">
                            <h6 class="mb-1">Cash Flow</h6>
                            <small class="text-muted">Cash inflows and outflows</small>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="report-item" onclick="generateReport('trial_balance')">
                            <h6 class="mb-1">Trial Balance</h6>
                            <small class="text-muted">Account balances verification</small>
                        </div>
                    </div>
                </div>
                <div class="text-center mt-3">
                    <a href="{% url 'reports:financial' %}" class="btn btn-primary">
                        <i class="fas fa-chart-line me-2"></i>All Financial Reports
                    </a>
                </div>
            </div>
        </div>

        <!-- Member Reports -->
        <div class="col-md-6 mb-4">
            <div class="report-category">
                <div class="d-flex align-items-center mb-3">
                    <div class="report-icon me-3" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
                        <i class="fas fa-users"></i>
                    </div>
                    <div>
                        <h4 class="mb-0">Membership Reports</h4>
                        <p class="text-muted mb-0">Member statistics, directories, and activity reports</p>
                    </div>
                </div>
                <div class="row">
                    <div class="col-6">
                        <div class="report-item" onclick="generateReport('member_directory')">
                            <h6 class="mb-1">Member Directory</h6>
                            <small class="text-muted">Complete member listing</small>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="report-item" onclick="generateReport('member_statistics')">
                            <h6 class="mb-1">Membership Statistics</h6>
                            <small class="text-muted">Growth and demographics</small>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="report-item" onclick="generateReport('member_financial')">
                            <h6 class="mb-1">Financial Summary</h6>
                            <small class="text-muted">Member financial profiles</small>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="report-item" onclick="generateReport('inactive_members')">
                            <h6 class="mb-1">Inactive Members</h6>
                            <small class="text-muted">Member retention analysis</small>
                        </div>
                    </div>
                </div>
                <div class="text-center mt-3">
                    <a href="{% url 'reports:membership' %}" class="btn btn-success">
                        <i class="fas fa-users me-2"></i>All Member Reports
                    </a>
                </div>
            </div>
        </div>

        <!-- Savings Reports -->
        <div class="col-md-6 mb-4">
            <div class="report-category">
                <div class="d-flex align-items-center mb-3">
                    <div class="report-icon me-3" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                        <i class="fas fa-piggy-bank"></i>
                    </div>
                    <div>
                        <h4 class="mb-0">Savings Reports</h4>
                        <p class="text-muted mb-0">Savings analysis, growth trends, and account summaries</p>
                    </div>
                </div>
                <div class="row">
                    <div class="col-6">
                        <div class="report-item" onclick="generateReport('savings_summary')">
                            <h6 class="mb-1">Savings Summary</h6>
                            <small class="text-muted">Overall savings overview</small>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="report-item" onclick="generateReport('savings_growth')">
                            <h6 class="mb-1">Growth Analysis</h6>
                            <small class="text-muted">Savings growth trends</small>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="report-item" onclick="generateReport('dormant_accounts')">
                            <h6 class="mb-1">Dormant Accounts</h6>
                            <small class="text-muted">Inactive savings accounts</small>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="report-item" onclick="generateReport('high_balance')">
                            <h6 class="mb-1">High Balance Accounts</h6>
                            <small class="text-muted">Top savers analysis</small>
                        </div>
                    </div>
                </div>
                <div class="text-center mt-3">
                    <a href="{% url 'reports:savings' %}" class="btn btn-warning">
                        <i class="fas fa-piggy-bank me-2"></i>All Savings Reports
                    </a>
                </div>
            </div>
        </div>

        <!-- Loan Reports -->
        <div class="col-md-6 mb-4">
            <div class="report-category">
                <div class="d-flex align-items-center mb-3">
                    <div class="report-icon me-3" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                        <i class="fas fa-hand-holding-usd"></i>
                    </div>
                    <div>
                        <h4 class="mb-0">Loan Reports</h4>
                        <p class="text-muted mb-0">Loan portfolio analysis, performance, and risk assessment</p>
                    </div>
                </div>
                <div class="row">
                    <div class="col-6">
                        <div class="report-item" onclick="generateReport('loan_portfolio')">
                            <h6 class="mb-1">Portfolio Summary</h6>
                            <small class="text-muted">Overall loan portfolio</small>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="report-item" onclick="generateReport('loan_performance')">
                            <h6 class="mb-1">Performance Analysis</h6>
                            <small class="text-muted">Repayment and default rates</small>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="report-item" onclick="generateReport('overdue_loans')">
                            <h6 class="mb-1">Overdue Loans</h6>
                            <small class="text-muted">Risk assessment report</small>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="report-item" onclick="generateReport('loan_disbursements')">
                            <h6 class="mb-1">Disbursements</h6>
                            <small class="text-muted">Loan disbursement analysis</small>
                        </div>
                    </div>
                </div>
                <div class="text-center mt-3">
                    <a href="{% url 'reports:loans' %}" class="btn btn-info">
                        <i class="fas fa-hand-holding-usd me-2"></i>All Loan Reports
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Advanced Reports Section -->
    <div class="row">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-gradient-dark text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-cogs me-2"></i>
                        Advanced Reports & Tools
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <a href="{% url 'reports:custom' %}" class="btn btn-outline-primary w-100 mb-3">
                                <i class="fas fa-magic d-block mb-2 fa-2x"></i>
                                <h6>Custom Reports</h6>
                                <small>Build your own reports</small>
                            </a>
                        </div>
                        <div class="col-md-3">
                            <a href="{% url 'reports:audit' %}" class="btn btn-outline-warning w-100 mb-3">
                                <i class="fas fa-search d-block mb-2 fa-2x"></i>
                                <h6>Audit Reports</h6>
                                <small>Compliance and audit trails</small>
                            </a>
                        </div>
                        <div class="col-md-3">
                            <a href="{% url 'reports:metrics' %}" class="btn btn-outline-info w-100 mb-3">
                                <i class="fas fa-tachometer-alt d-block mb-2 fa-2x"></i>
                                <h6>Performance Metrics</h6>
                                <small>KPI dashboard and analytics</small>
                            </a>
                        </div>
                        <div class="col-md-3">
                            <a href="{% url 'reports:export' %}" class="btn btn-outline-success w-100 mb-3">
                                <i class="fas fa-download d-block mb-2 fa-2x"></i>
                                <h6>Data Export</h6>
                                <small>Export data for external use</small>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Stats Overview -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-tachometer-alt me-2"></i>
                        Key Performance Indicators
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-2">
                            <div class="quick-stat">
                                <h4 class="text-primary">85%</h4>
                                <small>Loan Recovery Rate</small>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="quick-stat">
                                <h4 class="text-success">92%</h4>
                                <small>Member Retention</small>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="quick-stat">
                                <h4 class="text-info">15%</h4>
                                <small>Growth Rate</small>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="quick-stat">
                                <h4 class="text-warning">3.2%</h4>
                                <small>Default Rate</small>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="quick-stat">
                                <h4 class="text-dark">78%</h4>
                                <small>Savings Participation</small>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="quick-stat">
                                <h4 class="text-secondary">4.2</h4>
                                <small>Avg Loan Tenure</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Quick Report Modal -->
<div class="modal fade" id="quickReportModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-bolt me-2"></i>
                    Quick Report Generator
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Report Type</label>
                            <select class="form-select" id="quick-report-type">
                                <option value="">Select Report Type</option>
                                <option value="balance_sheet">Balance Sheet</option>
                                <option value="member_list">Member Directory</option>
                                <option value="savings_summary">Savings Summary</option>
                                <option value="loan_portfolio">Loan Portfolio</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Format</label>
                            <select class="form-select" id="quick-report-format">
                                <option value="html">View Online</option>
                                <option value="pdf">Download PDF</option>
                                <option value="excel">Download Excel</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">From Date</label>
                            <input type="date" class="form-control" id="quick-start-date">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">To Date</label>
                            <input type="date" class="form-control" id="quick-end-date">
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" id="generate-quick-report" class="btn btn-primary">
                    <i class="fas fa-chart-bar me-2"></i>Generate Report
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Set default dates
    const today = new Date().toISOString().split('T')[0];
    const firstDay = new Date(new Date().getFullYear(), new Date().getMonth(), 1).toISOString().split('T')[0];
    
    document.getElementById('quick-start-date').value = firstDay;
    document.getElementById('quick-end-date').value = today;

    // Quick report generation
    document.getElementById('generate-quick-report').addEventListener('click', function() {
        const reportType = document.getElementById('quick-report-type').value;
        const format = document.getElementById('quick-report-format').value;
        const startDate = document.getElementById('quick-start-date').value;
        const endDate = document.getElementById('quick-end-date').value;

        if (!reportType) {
            alert('Please select a report type');
            return;
        }

        this.innerHTML = '<i class=\"fas fa-spinner fa-spin me-2\"></i>Generating...';
        this.disabled = true;

        // Simulate report generation
        setTimeout(() => {
            bootstrap.Modal.getInstance(document.getElementById('quickReportModal')).hide();
            showAlert('success', `${reportType.replace('_', ' ').toUpperCase()} report generated successfully!`);
            
            // Reset button
            this.innerHTML = '<i class=\"fas fa-chart-bar me-2\"></i>Generate Report';
            this.disabled = false;
        }, 3000);
    });
});

function generateReport(reportType) {
    showAlert('info', `Generating ${reportType.replace('_', ' ')} report...`);
    
    // Here you would navigate to the appropriate report page
    setTimeout(() => {
        // Navigate based on report type
        let url = '';
        if (reportType.includes('balance') || reportType.includes('income') || reportType.includes('cash')) {
            url = "{% url 'reports:financial' %}";
        } else if (reportType.includes('member')) {
            url = "{% url 'reports:membership' %}";
        } else if (reportType.includes('savings')) {
            url = "{% url 'reports:savings' %}";
        } else if (reportType.includes('loan')) {
            url = "{% url 'reports:loans' %}";
        }
        
        if (url) {
            window.location.href = url + '?report_type=' + reportType;
        }
    }, 1000);
}

function showAlert(type, message) {
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
    alertDiv.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    const container = document.querySelector('.container-fluid');
    container.insertBefore(alertDiv, container.firstChild);
    
    // Auto-dismiss after 5 seconds
    setTimeout(() => {
        alertDiv.remove();
    }, 5000);
}

// Real-time dashboard updates (placeholder)
function updateDashboard() {
    // This would fetch updated statistics via AJAX
    console.log('Updating dashboard...');
}

// Update every 2 minutes
setInterval(updateDashboard, 120000);
</script>
{% endblock %}
